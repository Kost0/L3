<!DOCTYPE html>
<html lang="en">
<style>
    body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
    }
    .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 { color: #333; }
    h2 {
        color: #555;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
    }
    input, button {
        padding: 10px;
        margin: 5px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }
    input {
        width: 300px;
    }
    button {
        background-color: #007bff;
        color: white;
        cursor: pointer;
        border: none;
        min-width: 120px;
    }
    button:hover {
        background-color: #0056b3;
    }
    .form-group {
        margin: 15px 0;
    }
    .response {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 15px;
        margin-top: 15px;
        white-space: pre-wrap;
        font-family: monospace;
        max-height: 400px;
        overflow-y: auto;
    }
    label {
        display: inline-block;
        width: 150px;
        font-weight: bold;
    }
</style>
<head>
    <meta charset="UTF-8">
    <title>Админ панель</title>
</head>
<body>
<h1>Панель администратора - Тестирование API</h1>

<div class="container">
    <h2>Создать мероприятие</h2>
    <form id="createEventForm">
        <div class="form-group">
            <label>Название:</label>
            <input type="text" id="eventName" placeholder="Название мероприятия" required>
        </div>
        <div class="form-group">
            <label>Дата и время:</label>
            <input type="datetime-local" id="eventDate" required>
        </div>
        <div class="form-group">
            <label>Количество мест:</label>
            <input type="number" id="eventCapacity" placeholder="100" min="1" required>
        </div>
        <button type="submit">Создать мероприятие</button>
    </form>
    <div id="createEventResponse" class="response" style="display:none;"></div>
</div>

<div class="container">
    <h2>Получить детали мероприятия</h2>
    <div class="form-group">
        <label>ID мероприятия:</label>
        <input type="text" id="getEventId" placeholder="Введите ID мероприятия">
        <button onclick="getEvent()">Получить детали</button>
    </div>
    <div id="getEventResponse" class="response" style="display:none;"></div>
</div>

<div class="container">
    <h2>Забронировать место</h2>
    <div class="form-group">
        <label>ID мероприятия:</label>
        <input type="text" id="bookEventId" placeholder="Введите ID мероприятия">
    </div>
    <div class="form-group">
        <label>Номер места:</label>
        <input type="number" id="bookSeatIndex" placeholder="1" min="1" required>
    </div>
    <button onclick="bookSeat()">Забронировать</button>
    <div id="bookSeatResponse" class="response" style="display:none;"></div>
</div>

<div class="container">
    <h2>Подтвердить бронирование (оплата)</h2>
    <div class="form-group">
        <label>ID мероприятия:</label>
        <input type="text" id="confirmEventId" placeholder="Введите ID мероприятия">
    </div>
    <div class="form-group">
        <label>Номер места:</label>
        <input type="number" id="confirmSeatIndex" placeholder="1" min="1" required>
    </div>
    <button onclick="confirmBooking()">Подтвердить оплату</button>
    <div id="confirmBookingResponse" class="response" style="display:none;"></div>
</div>

<script>
    const API_BASE = 'http://localhost:8080';

    document.getElementById('createEventForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const title = document.getElementById('eventName').value;
        const date = document.getElementById('eventDate').value + ":00Z";
        const amount_of_seats = parseInt(document.getElementById('eventCapacity').value);

        const responseDiv = document.getElementById('createEventResponse');
        responseDiv.style.display = 'block';
        responseDiv.className = 'response';
        responseDiv.textContent = 'Отправка запроса...';

        try {
            const response = await fetch(`${API_BASE}/events`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({title, date, amount_of_seats})
            });

            const data = await response.json();

            if (response.ok) {
                responseDiv.className = 'response success';
                responseDiv.textContent = `Успех!\n\n${JSON.stringify(data, null, 2)}`;
            } else {
                responseDiv.className = 'response error';
                responseDiv.textContent = `Ошибка ${response.status}:\n\n${JSON.stringify(data, null, 2)}`;
            }
        } catch (error) {
            responseDiv.className = 'response error';
            responseDiv.textContent = `Ошибка подключения:\n\n${error.message}`;
            console.error('Fetch error:', error);
        }
    });

    async function getEvent() {
        const eventId = document.getElementById('getEventId').value;
        const responseDiv = document.getElementById('getEventResponse');

        if (!eventId) {
            responseDiv.style.display = 'block';
            responseDiv.className = 'response error';
            responseDiv.textContent = 'Введите ID мероприятия';
            return;
        }

        responseDiv.style.display = 'block';
        responseDiv.className = 'response';
        responseDiv.textContent = 'Загрузка...';

        try {
            const response = await fetch(`${API_BASE}/events/${eventId}`);
            const data = await response.json();

            if (response.ok) {
                responseDiv.className = 'response success';

                let html = `Мероприятие найдено!\n\n`;
                html += `ID: ${data.uuid}\n`;
                html += `Название: ${data.title}\n`;
                html += `Дата: ${new Date(data.date).toLocaleString('ru-RU')}\n`;
                html += `Всего мест: ${data.amount_of_seats}\n`;
                html += `Свободно: ${data.available_seats}\n\n`;
                html += `JSON Response:\n${JSON.stringify(data, null, 2)}`;

                responseDiv.textContent = html;

                if (data.seats && data.seats.length > 0) {
                    const seatsDiv = document.createElement('div');
                    seatsDiv.className = 'seats-grid';
                    seatsDiv.innerHTML = '<strong>Карта мест:</strong><br>';

                    data.seats.forEach(seat => {
                        const seatEl = document.createElement('span');
                        seatEl.className = `seat seat-${seat.status}`;
                        seatEl.textContent = `${seat.index}`;
                        seatEl.title = `Место ${seat.index}: ${seat.status}`;
                        seatsDiv.appendChild(seatEl);
                    });

                    responseDiv.appendChild(seatsDiv);
                }
            } else {
                responseDiv.className = 'response error';
                responseDiv.textContent = `Ошибка ${response.status}:\n\n${JSON.stringify(data, null, 2)}`;
            }
        } catch (error) {
            responseDiv.className = 'response error';
            responseDiv.textContent = `Ошибка подключения:\n\n${error.message}`;
            console.error('Fetch error:', error);
        }
    }

    async function bookSeat() {
        const eventId = document.getElementById('bookEventId').value;
        const seat_index = parseInt(document.getElementById('bookSeatIndex').value);

        const responseDiv = document.getElementById('bookSeatResponse');

        if (!eventId) {
            responseDiv.style.display = 'block';
            responseDiv.className = 'response error';
            responseDiv.textContent = 'Введите ID мероприятия';
            return;
        }

        responseDiv.style.display = 'block';
        responseDiv.className = 'response';
        responseDiv.textContent = 'Отправка запроса...';

        try {
            const response = await fetch(`${API_BASE}/events/${eventId}/book`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({seat_index})
            });

            const data = await response.json();

            if (response.ok) {
                responseDiv.className = 'response success';
                responseDiv.textContent = `Место забронировано!\n\n${JSON.stringify(data, null, 2)}`;
            } else {
                responseDiv.className = 'response error';
                responseDiv.textContent = `Ошибка ${response.status}:\n\n${JSON.stringify(data, null, 2)}`;
            }
        } catch (error) {
            responseDiv.className = 'response error';
            responseDiv.textContent = `Ошибка подключения:\n\n${error.message}`;
            console.error('Fetch error:', error);
        }
    }

    async function confirmBooking() {
        const eventId = document.getElementById('confirmEventId').value;
        const seat_index = parseInt(document.getElementById('confirmSeatIndex').value);

        const responseDiv = document.getElementById('confirmBookingResponse');

        if (!eventId) {
            responseDiv.style.display = 'block';
            responseDiv.className = 'response error';
            responseDiv.textContent = 'Введите ID мероприятия';
            return;
        }

        responseDiv.style.display = 'block';
        responseDiv.className = 'response';
        responseDiv.textContent = 'Отправка запроса...';

        try {
            const response = await fetch(`${API_BASE}/events/${eventId}/confirm`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({seat_index})
            });

            const data = await response.json();

            if (response.ok) {
                responseDiv.className = 'response success';
                responseDiv.textContent = `Оплата подтверждена!\n\n${JSON.stringify(data, null, 2)}`;
            } else {
                responseDiv.className = 'response error';
                responseDiv.textContent = `Ошибка ${response.status}:\n\n${JSON.stringify(data, null, 2)}`;
            }
        } catch (error) {
            responseDiv.className = 'response error';
            responseDiv.textContent = `Ошибка подключения:\n\n${error.message}`;
            console.error('Fetch error:', error);
        }
    }
</script>
</body>
</html>